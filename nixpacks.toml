[phases.setup]
nixPkgs = [
  "python311",
  "cairo",
  "pango",
  "harfbuzz",
  "fontconfig",
  "gdk-pixbuf",
  "glib",
  "gobject-introspection",
  "libxml2",
  "libxslt",
  "freetype",
  "libpng",
  "fribidi",
  "gtk3",
  "shared-mime-info",
  "libffi",
  "pkg-config"
]

[phases.install]
cmds = [
  "python3 -m venv --copies /opt/venv",
  ". /opt/venv/bin/activate",
  "pip install --no-cache-dir -r requirements.txt"
]

[variables]
LD_LIBRARY_PATH = "${HOME}/.nix-profile/lib:/nix/var/nix/profiles/default/lib:${LD_LIBRARY_PATH}"
GI_TYPELIB_PATH = "${HOME}/.nix-profile/lib/girepository-1.0:${GI_TYPELIB_PATH}"
XDG_DATA_DIRS = "${HOME}/.nix-profile/share:/usr/local/share:/usr/share:${XDG_DATA_DIRS}"
PYTHONUNBUFFERED = "1"

[start]
cmd = "uvicorn main:app --host 0.0.0.0 --port $PORT"

